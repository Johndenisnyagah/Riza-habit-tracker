<!DOCTYPE html>
<html lang="en">
  <!-- =========================================================
       RIZA HABIT TRACKER | DASHBOARD PAGE
       
       Purpose: Main dashboard interface for habit tracking
       
       Features:
       - Personalized welcome message with user's name
       - Weekly progress chart visualization
       - Daily motivation quotes with refresh
       - Real-time habit check-in status
       - Statistics: Total logins, longest streak, total habits
       - Current streak with animated flame
       - Habit summary list with filters
       - Add/Edit habit modal
       
       Data Source: All data from MongoDB via backend API
       
       Dependencies:
       - Chart.js for progress visualization
       - Lottie animations for streak flame
       - Shared components (sidebar, habit manager, API)
       
       Author: John kirungia Denis Nyagah
       ========================================================= -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Riza | Dashboard</title>

    <!-- ==================== STYLESHEETS ==================== -->
    <!-- Sidebar component styles (shared across pages) -->
    <link rel="preload" href="/frontend/components/sidebar.css" as="style" />
    <link rel="stylesheet" href="/frontend/components/sidebar.css" />

    <!-- Font Awesome icons for UI elements -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- Dashboard-specific styles -->
    <link rel="stylesheet" href="dashboard.css" />

    <!-- Lottie animation library for streak flame effect -->
    <script
      src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.5/dist/dotlottie-wc.js"
      type="module"
    ></script>
  </head>

  <body>
    <div class="dashboard-container">
      <!-- ========================= SIDEBAR ========================= -->
      <!-- Navigation sidebar loaded dynamically via main.js -->
      <div id="sidebar-container"></div>

      <!-- ====================== MAIN CONTENT ====================== -->
      <main class="main-content">
        <!-- ==================== HEADER ==================== -->
        <!-- Displays personalized welcome message with user's name from MongoDB -->
        <header class="dashboard-header">
          <!-- Mobile menu toggle button (visible on small screens) -->
          <button class="menu-toggle" aria-label="Open menu">
            <img
              src="../assets/icons/menu.svg"
              aria-hidden="true"
              class="menu-icon"
            />
          </button>

          <div class="header-text">
            <!-- User name loaded dynamically from backend -->
            <h1>Welcome back, <span id="user-name-display"></span></h1>
            <p>Here's an overview of your week</p>
          </div>
        </header>

        <!-- ===================== DASHBOARD GRID ===================== -->
        <!-- Main dashboard content organized in responsive card grid -->
        <section class="dashboard-grid" aria-label="Dashboard overview">
          <!-- ==================== ADD HABIT CARD ==================== -->
          <!-- Quick access to create new habits -->
          <div class="card add-habit">
            <h3>
              <img
                src="../assets/icons/plus-circle.svg"
                class="icon"
                aria-hidden="true"
              />
              Add Habit
            </h3>
            <p>Create a new habit to track</p>

            <!-- Opens modal for habit creation -->
            <button class="btn open-habit-modal">Get Started</button>
          </div>

          <!-- ==================== WEEKLY PROGRESS CHART ==================== -->
          <!-- Chart.js visualization of habit completions over past 7 days -->
          <!-- Data source: MongoDB via /api/checkins -->
          <div class="card progress-chart">
            <h3>
              <img
                src="../assets/icons/bar-chart-2.svg"
                class="icon"
                aria-hidden="true"
              />
              Weekly Progress
            </h3>
            <canvas
              id="progressChart"
              aria-label="Weekly Progress Chart"
            ></canvas>
          </div>

          <!-- ==================== DAILY OVERVIEW CARD ==================== -->
          <!-- Combines motivation quote and today's check-in status -->
          <div class="card daily-overview">
            <h3>
              <img
                src="../assets/icons/sparkles.svg"
                class="icon"
                aria-hidden="true"
              />
              Daily Overview
            </h3>

            <!-- Motivation Section: Randomized daily quotes -->
            <div class="motivation-section">
              <div class="motivation-content">
                <blockquote id="motivationText">
                  "Small consistent steps lead to big changes."
                </blockquote>
                <div class="motivation-footer">
                  <span class="quote-category" id="quoteCategory"
                    >Consistency</span
                  >
                  <!-- Refresh button to get new quote -->
                  <button
                    class="refresh-quote"
                    id="refreshQuote"
                    title="Get new quote"
                  >
                    <img src="../assets/icons/refresh.svg" alt="Refresh" />
                  </button>
                </div>
              </div>
            </div>

            <!-- Visual divider -->
            <div class="section-divider"></div>

            <!-- Today's Check-ins: Shows completion ratio -->
            <!-- Updates automatically when habits are checked/unchecked -->
            <!-- Data source: MongoDB via /api/checkins -->
            <div class="checkins-section">
              <div class="checkins-header">
                <img
                  src="../assets/icons/check-circle.svg"
                  class="section-icon"
                  aria-hidden="true"
                />
                <h4>Today's Check-ins</h4>
              </div>
              <!-- Format: "X/Y habits completed" -->
              <p class="checkins-status">3/4 habits completed</p>
              <a class="btn-outline" href="../progress/progress.html"
                >View Check-in Details</a
              >
            </div>
          </div>

          <!-- ==================== STATISTICS CARD ==================== -->
          <!-- Displays key metrics from backend -->
          <!-- All data from MongoDB, no localStorage -->
          <div class="card stats">
            <h3>
              <img
                src="../assets/icons/stats.svg"
                class="icon"
                aria-hidden="true"
              />
              Stats
            </h3>
            <div class="stats-content">
              <!-- Total Logins: Unique days user logged into app -->
              <!-- Data source: /api/logins/count -->
              <div class="stat-item">
                <div class="stat-icon">
                  <img src="../assets/icons/calendar.svg" alt="Calendar" />
                </div>
                <div class="stat-info">
                  <span class="stat-label">Total Logins</span>
                  <span class="stat-value" id="dashboard-total-checkins"
                    >0</span
                  >
                </div>
              </div>

              <!-- Longest Streak: Maximum consecutive days with completions -->
              <!-- Calculated from /api/checkins data -->
              <div class="stat-item">
                <div class="stat-icon">
                  <img src="../assets/icons/flame.svg" alt="Flame" />
                </div>
                <div class="stat-info">
                  <span class="stat-label">Longest Streak</span>
                  <span class="stat-value">
                    <strong id="dashboard-longest-streak">7</strong> days
                  </span>
                </div>
              </div>

              <!-- Total Habits: Number of habits user has created -->
              <!-- Data source: /api/habits -->
              <div class="stat-item">
                <div class="stat-icon">
                  <img src="../assets/icons/target.svg" alt="Target" />
                </div>
                <div class="stat-info">
                  <span class="stat-label">Total Habits</span>
                  <span class="stat-value" id="dashboard-total-habits">0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- ==================== CURRENT STREAK CARD ==================== -->
          <!-- Displays consecutive days with habit completions -->
          <!-- Features animated flame that grows with streak length -->
          <!-- Data source: MongoDB via /api/checkins -->
          <div class="card streak">
            <h3>
              <img
                src="../assets/icons/flame.svg"
                class="icon"
                aria-hidden="true"
              />
              Current Streak
            </h3>
            <div class="streak-content">
              <!-- Animated flame container (Lottie animation) -->
              <!-- Flame size scales based on streak: 80px-200px -->
              <div class="streak-flame-container">
                <dotlottie-wc
                  id="dashboard-flame-animation"
                  src="https://lottie.host/56d7da74-9728-4b30-9850-2f882c814d31/JxaPzJMak3.lottie"
                  autoplay
                  loop
                ></dotlottie-wc>

                <!-- Streak number overlay on flame -->
                <div class="streak-overlay">
                  <span class="streak-number" id="dashboard-current-streak"
                    >7</span
                  >
                  <span class="streak-label">days</span>
                </div>
              </div>

              <!-- Milestone badges (7, 30, 100 days) -->
              <!-- Highlights automatically when achieved -->
              <div class="streak-milestones">
                <div class="milestone" id="dashboard-milestone-7">
                  <span class="milestone-icon">⭐</span>
                  <span class="milestone-text">7 days</span>
                </div>
                <div class="milestone" id="dashboard-milestone-30">
                  <span class="milestone-icon">🏆</span>
                  <span class="milestone-text">30 days</span>
                </div>
                <div class="milestone" id="dashboard-milestone-100">
                  <span class="milestone-icon">👑</span>
                  <span class="milestone-text">100 days</span>
                </div>
              </div>
            </div>
          </div>

          <!-- ==================== HABIT SUMMARY CARD ==================== -->
          <!-- Lists all user's habits with check-in checkboxes -->
          <!-- Includes filters and edit/delete buttons -->
          <!-- Data source: MongoDB via /api/habits and /api/checkins -->
          <div class="card habit-summary">
            <h3>
              <img
                src="../assets/icons/list-tree.svg"
                class="icon"
                aria-hidden="true"
              />
              Habit Summary
            </h3>

            <!-- Filter buttons: All, Daily, Weekdays, Weekends, Custom -->
            <div class="habit-filters">
              <button class="filter-btn active" data-filter="all">All</button>
              <button class="filter-btn" data-filter="daily">Daily</button>
              <button class="filter-btn" data-filter="weekdays">
                Weekdays
              </button>
              <button class="filter-btn" data-filter="weekends">
                Weekends
              </button>
              <button class="filter-btn" data-filter="custom">Custom</button>
            </div>

            <!-- Habit list populated dynamically by habit-manager.js -->
            <!-- Updates in real-time when habits added/edited/deleted -->
            <ul id="habit-list" class="habit-list" aria-live="polite"></ul>
          </div>
        </section>
        <!-- End of dashboard-grid -->

        <!-- ===================== HABIT MODAL ===================== -->
        <!-- Modal popup for creating and editing habits -->
        <!-- Managed by habit-manager.js -->
        <div id="habit-modal" class="modal" aria-hidden="true">
          <div class="modal-content">
            <!-- Modal header with title and close button -->
            <div class="modal-header">
              <!-- Title changes: "Add New Habit" or "Edit Habit" -->
              <h3 id="modal-title">Add New Habit</h3>
              <button class="close-modal" aria-label="Close">&times;</button>
            </div>

            <!-- Modal body with form fields -->
            <div class="modal-body">
              <form id="habit-form">
                <!-- Habit name input (required) -->
                <div class="form-group">
                  <label for="habit-name">Habit Name</label>
                  <input
                    type="text"
                    id="habit-name"
                    required
                    placeholder="e.g., Morning Meditation"
                  />
                </div>

                <!-- Description textarea (optional) -->
                <div class="form-group">
                  <label for="habit-description">Description (Optional)</label>
                  <textarea
                    id="habit-description"
                    placeholder="Why this habit matters to you..."
                  ></textarea>
                </div>

                <!-- Frequency selection buttons -->
                <!-- Options: Daily, Weekdays, Weekends, Custom -->
                <!-- Saved to MongoDB in habit.frequency field -->
                <div class="form-group">
                  <label>Frequency</label>
                  <div class="frequency-options">
                    <button
                      type="button"
                      class="freq-btn active"
                      data-value="daily"
                    >
                      Daily
                    </button>
                    <button
                      type="button"
                      class="freq-btn"
                      data-value="weekdays"
                    >
                      Weekdays
                    </button>
                    <button
                      type="button"
                      class="freq-btn"
                      data-value="weekends"
                    >
                      Weekends
                    </button>
                    <button type="button" class="freq-btn" data-value="custom">
                      Custom
                    </button>
                  </div>
                </div>

                <!-- Custom days checkboxes (shown only when Custom selected) -->
                <!-- Selected days saved to MongoDB in habit.customDays array -->
                <div class="form-group custom-days hidden">
                  <div class="day-checkboxes">
                    <label><input type="checkbox" value="mon" /> Mon</label>
                    <label><input type="checkbox" value="tue" /> Tue</label>
                    <label><input type="checkbox" value="wed" /> Wed</label>
                    <label><input type="checkbox" value="thu" /> Thu</label>
                    <label><input type="checkbox" value="fri" /> Fri</label>
                    <label><input type="checkbox" value="sat" /> Sat</label>
                    <label><input type="checkbox" value="sun" /> Sun</label>
                  </div>
                </div>

                <!-- Icon selection grid -->
                <!-- Icons loaded dynamically from habit-icons-config.js -->
                <!-- Selected icon saved to MongoDB in habit.icon field -->
                <div class="form-group">
                  <label>Choose Icon</label>
                  <div class="icon-selector" id="icon-selector">
                    <!-- Icons populated by loadHabitIcons() in dashboard.js -->
                  </div>
                </div>
              </form>
            </div>

            <!-- Modal footer with action buttons -->
            <div class="modal-footer">
              <button type="button" class="btn-outline cancel-btn">
                Cancel
              </button>
              <button type="button" class="btn save-btn">Save Habit</button>
              <!-- Delete button (shown only in edit mode) -->
              <button type="button" class="btn-danger delete-btn hidden">
                Delete
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- ==================== JAVASCRIPT DEPENDENCIES ==================== -->
    <!-- Chart.js library for weekly progress visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Main application script (loads sidebar dynamically) -->
    <script src="/frontend/main.js"></script>

    <!-- Daily motivation quotes module -->
    <script src="../shared/daily-motivation.js"></script>

    <!-- Dashboard functionality (ES6 module) -->
    <!-- Handles: initialization, stats updates, chart, habit management -->
    <script type="module" src="dashboard.js"></script>
  </body>
</html>
