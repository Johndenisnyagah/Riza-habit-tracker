<!DOCTYPE html>
<html lang="en">
  <!-- =========================================================
       RIZA HABIT TRACKER | HABITS PAGE
       
       Purpose: 
       - Main habits management interface
       - Create, edit, delete, and track habits
       - View statistics and current streak
       - Filter habits by frequency
       
       Page Layout:
       - Top Row: 3 equal-height cards (Daily Overview, Stats, Streak)
       - Bottom: Full-width habit list with filters
       
       Page Features:
       - Habit creation modal with icon selection
       - Real-time statistics (total habits, logins, streaks)
       - Animated flame showing current streak
       - Filter system (All, Daily, Weekdays, Weekends, Custom)
       - Daily motivation quotes with refresh
       - Responsive design (mobile, tablet, desktop)
       
       Data Flow:
       1. User creates/edits habits → MongoDB storage
       2. Check-ins tracked daily → Streak calculation
       3. Statistics updated in real-time
       4. Filter selection → Display matching habits
       
       Components:
       - Sidebar: Navigation (imported from components)
       - Daily Overview: Add habit + motivation quote
       - Stats Card: Total habits, logins, longest streak
       - Streak Card: Animated flame with milestones
       - Habit List: All habits with filters
       - Modal: Create/edit habit form
       
       Dependencies:
       - habits.css (page styles)
       - sidebar.css (navigation component)
       - main.js (sidebar loader)
       - daily-motivation.js (quote system)
       - habits.js (page controller)
       - habit-manager.js (CRUD operations)
       - api.js (backend communication)
       - Lottie Web Component (flame animation)
       - Font Awesome (icons)
       
       Data Sources (MongoDB via API):
       - GET /api/habits (user's habits)
       - GET /api/checkins/habit/:id (completion history)
       - GET /api/logins/count (login statistics)
       - POST /api/habits (create habit)
       - PUT /api/habits/:id (update habit)
       - DELETE /api/habits/:id (delete habit)

       Author: John Denis Nyagah
       ========================================================= -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Riza | Habits</title>

    <!-- =========================================================
         EXTERNAL STYLESHEETS
         ========================================================= -->

    <!-- Sidebar navigation component styles -->
    <link rel="preload" href="/frontend/components/sidebar.css" as="style" />
    <link rel="stylesheet" href="/frontend/components/sidebar.css" />

    <!-- Font Awesome icon library (v6.5.0) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- Habits page specific styles -->
    <link rel="stylesheet" href="habits.css" />

    <!-- =========================================================
         EXTERNAL SCRIPTS
         Lottie animation library for flame effect
         ========================================================= -->
    <script
      src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.5/dist/dotlottie-wc.js"
      type="module"
    ></script>
  </head>

  <body>
    <div class="dashboard-container">
      <!-- =========================================================
           SIDEBAR NAVIGATION
           Purpose: Main navigation component (shared across pages)
           Loaded dynamically via main.js
           ========================================================= -->
      <div id="sidebar-container"></div>

      <!-- =========================================================
           MAIN CONTENT AREA
           ========================================================= -->
      <main class="main-content">
        <!-- =========================================================
             PAGE HEADER
             Purpose: Page title and mobile menu toggle
             
             Components:
             - Menu toggle button (mobile only)
             - Page title: "Your Habits"
             - Subtitle: "Build consistency one step at a time"
             ========================================================= -->
        <header class="dashboard-header">
          <!-- Mobile menu toggle button (hidden on desktop) -->
          <button class="menu-toggle" aria-label="Open menu">
            <img
              src="/frontend/assets/icons/menu.svg"
              aria-hidden="true"
              class="menu-icon"
            />
          </button>

          <!-- Page title and subtitle -->
          <div class="header-text">
            <h1>Your Habits</h1>
            <p>Build consistency one step at a time</p>
          </div>
        </header>

        <!-- =========================================================
             HABITS SECTION (Main Content)
             Purpose: Container for all habit cards
             
             Layout:
             - Top Row: 3 cards (Daily Overview, Stats, Streak)
             - Bottom: Full-width habit list
             ========================================================= -->
        <section class="habits-section">
          <!-- =========================================================
               TOP ROW - THREE EQUAL-HEIGHT CARDS
               Grid layout: 3 columns on desktop, stacks on mobile
               ========================================================= -->
          <div class="habits-top">
            <!-- =========================================================
                 CARD 1: DAILY OVERVIEW (Combined Add Habit + Motivation)
                 Purpose: Habit creation entry point and daily motivation
                 
                 Sections:
                 1. Add New Habit - Quick access to habit creation
                 2. Daily Motivation - Inspirational quote with refresh
                 
                 Features:
                 - "Get Started" button opens habit modal
                 - Quote changes daily (from daily-motivation.js)
                 - Manual refresh button for new quotes
                 - Category badge shows quote theme
                 
                 Animation: .anim-1 class (fade-up entrance)
                 ========================================================= -->
            <div class="card daily-overview anim-1">
              <!-- Card title with sparkles icon -->
              <h3>
                <img
                  src="../assets/icons/sparkles.svg"
                  class="icon"
                  aria-hidden="true"
                />
                Daily Overview
              </h3>

              <!-- =========================================================
                   ADD HABIT SECTION
                   Purpose: Quick access to habit creation
                   Action: Opens habit modal on button click
                   ========================================================= -->
              <div class="add-habit-section">
                <div class="section-header">
                  <img
                    src="../assets/icons/plus-circle.svg"
                    class="section-icon"
                    aria-hidden="true"
                  />
                  <h4>Add New Habit</h4>
                </div>
                <p>Create a new habit to track</p>
                <!-- Opens modal (handled by habit-manager.js) -->
                <button class="btn open-habit-modal">Get Started</button>
              </div>

              <!-- Visual divider between sections -->
              <div class="section-divider"></div>

              <!-- =========================================================
                   MOTIVATION SECTION
                   Purpose: Display daily inspirational quote
                   
                   Features:
                   - Quote text updates daily
                   - Category badge (e.g., "Consistency", "Growth")
                   - Refresh button for new quote
                   - Quotes managed by daily-motivation.js
                   
                   DOM Elements:
                   - #motivationText: Quote content (populated by JS)
                   - #quoteCategory: Theme badge (populated by JS)
                   - #refreshQuote: Manual refresh trigger
                   ========================================================= -->
              <div class="motivation-section">
                <div class="motivation-content">
                  <!-- Quote text (default shown, replaced by JS) -->
                  <blockquote id="motivationText">
                    "Small consistent steps lead to big changes."
                  </blockquote>

                  <!-- Quote footer with category and refresh -->
                  <div class="motivation-footer">
                    <!-- Category badge (e.g., "Consistency") -->
                    <span class="quote-category" id="quoteCategory"
                      >Consistency</span
                    >
                    <!-- Refresh button -->
                    <button
                      class="refresh-quote"
                      id="refreshQuote"
                      title="Get new quote"
                    >
                      <img src="../assets/icons/refresh.svg" alt="Refresh" />
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- =========================================================
                 CARD 2: STATISTICS
                 Purpose: Display key habit metrics
                 
                 Metrics (all from MongoDB):
                 1. Total Check-ins: Unique days with at least one login
                 2. Longest Streak: Maximum consecutive completion days
                 3. Total Habits: Count of active habits
                 
                 Data Sources:
                 - Total Check-ins: /api/logins/count
                 - Longest Streak: Calculated from /api/checkins
                 - Total Habits: /api/habits (count)
                 
                 Updates: Real-time when habits change
                 Animation: .anim-2 class (fade-up with delay)
                 ========================================================= -->
            <div class="card stats anim-2">
              <!-- Card title with stats icon -->
              <h3>
                <img
                  src="../assets/icons/stats.svg"
                  class="icon"
                  aria-hidden="true"
                />
                Stats
              </h3>

              <!-- Statistics grid -->
              <div class="stats-content">
                <!-- Stat 1: Total Check-ins (login days) -->
                <div class="stat-item">
                  <div class="stat-icon">
                    <img src="../assets/icons/calendar.svg" alt="Calendar" />
                  </div>
                  <div class="stat-info">
                    <span class="stat-label">Total Check-ins</span>
                    <!-- Value populated by habits.js updateStatsCard() -->
                    <span class="stat-value" id="habits-total-checkins">0</span>
                  </div>
                </div>

                <!-- Stat 2: Longest Streak -->
                <div class="stat-item">
                  <div class="stat-icon">
                    <img src="../assets/icons/flame.svg" alt="Flame" />
                  </div>
                  <div class="stat-info">
                    <span class="stat-label">Longest Streak</span>
                    <span class="stat-value">
                      <!-- Value populated by habits.js calculateLongestStreak() -->
                      <strong id="habits-longest-streak">0</strong> days
                    </span>
                  </div>
                </div>

                <!-- Stat 3: Total Habits -->
                <div class="stat-item">
                  <div class="stat-icon">
                    <img src="../assets/icons/target.svg" alt="Target" />
                  </div>
                  <div class="stat-info">
                    <span class="stat-label">Total Habits</span>
                    <!-- Value populated by habits.js updateStatsCard() -->
                    <span class="stat-value" id="habits-total-habits">0</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- =========================================================
                 CARD 3: CURRENT STREAK
                 Purpose: Visual representation of active streak
                 
                 Features:
                 - Animated Lottie flame (scales with streak length)
                 - Streak number overlay on flame
                 - Milestone badges (7, 30, 100 days)
                 - Real-time updates on habit completion
                 
                 Flame Sizes:
                 - 0 days: 80px (small)
                 - 1-6 days: Growing (80-145px)
                 - 7-29 days: Medium (145-170px)
                 - 30-99 days: Large (170-200px)
                 - 100+ days: Champion (200px max)
                 
                 Calculation:
                 - Counts consecutive days from today backwards
                 - Stops when a day has no completions
                 - Updated by habits.js updateCurrentStreak()
                 
                 Animation: .anim-3 class (fade-up with delay)
                 ========================================================= -->
            <div class="card streak anim-3">
              <!-- Card title with flame icon -->
              <h3>
                <img
                  src="../assets/icons/flame.svg"
                  class="icon"
                  aria-hidden="true"
                />
                Current Streak
              </h3>

              <!-- Streak content container -->
              <div class="streak-content">
                <!-- =========================================================
                     ANIMATED FLAME WITH STREAK NUMBER
                     Purpose: Visual representation of streak progress
                     
                     Components:
                     - Lottie animation: Animated flame (loops continuously)
                     - Overlay: Streak number and "days" label
                     
                     Behavior:
                     - Flame size scales based on streak length
                     - Number updates in real-time
                     - Positioned absolutely for overlay effect
                     ========================================================= -->
                <div class="streak-flame-container">
                  <!-- Lottie flame animation (size controlled by JS) -->
                  <dotlottie-wc
                    id="habits-flame-animation"
                    src="https://lottie.host/56d7da74-9728-4b30-9850-2f882c814d31/JxaPzJMak3.lottie"
                    autoplay
                    loop
                  ></dotlottie-wc>

                  <!-- Streak number overlay -->
                  <div class="streak-overlay">
                    <!-- Streak count (populated by habits.js) -->
                    <span class="streak-number" id="habits-current-streak"
                      >7</span
                    >
                    <!-- Label -->
                    <span class="streak-label">days</span>
                  </div>
                </div>

                <!-- =========================================================
                     MILESTONE BADGES
                     Purpose: Show achievement progress
                     
                     Milestones:
                     - 7 days: ⭐ (First week)
                     - 30 days: 🏆 (One month)
                     - 100 days: 👑 (Champion)
                     
                     Behavior:
                     - .achieved class added when milestone reached
                     - Color changes from gray to green
                     - Updated by habits.js updateCurrentStreak()
                     ========================================================= -->
                <div class="streak-milestones">
                  <!-- 7 days milestone -->
                  <div class="milestone" id="habits-milestone-7">
                    <span class="milestone-icon">⭐</span>
                    <span class="milestone-text">7 days</span>
                  </div>
                  <!-- 30 days milestone -->
                  <div class="milestone" id="habits-milestone-30">
                    <span class="milestone-icon">🏆</span>
                    <span class="milestone-text">30 days</span>
                  </div>
                  <!-- 100 days milestone -->
                  <div class="milestone" id="habits-milestone-100">
                    <span class="milestone-icon">👑</span>
                    <span class="milestone-text">100 days</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- =========================================================
               BOTTOM SECTION: MY HABITS LIST
               Purpose: Display and manage all user habits
               
               Features:
               - Filter buttons (All, Daily, Weekdays, Weekends, Custom)
               - Scrollable habit list with custom scrollbar
               - Habit items with checkbox, name, description, actions
               - Edit and delete buttons per habit
               - Empty state message when no habits
               
               Interaction:
               - Click checkbox to complete habit (tracked in MongoDB)
               - Click filter to show matching habits
               - Click edit to open modal with habit data
               - Click delete to remove habit (confirmation required)
               
               Data Source: MongoDB via /api/habits
               Animation: .anim-4 class (fade-up with delay)
               ========================================================= -->
          <div class="card habit-list anim-4">
            <!-- Card title with list icon -->
            <h3>
              <img
                src="../assets/icons/list-tree.svg"
                class="icon"
                aria-hidden="true"
              />
              My Habits
            </h3>

            <!-- =========================================================
                 HABIT FILTERS
                 Purpose: Filter habits by frequency type
                 
                 Filter Options:
                 - All: Show all habits (default)
                 - Daily: Show habits scheduled every day
                 - Weekdays: Show Mon-Fri habits
                 - Weekends: Show Sat-Sun habits
                 - Custom: Show habits with custom day selection
                 
                 Behavior:
                 - Active filter gets .active class (green background)
                 - Click triggers filter in habit-manager.js
                 - Habit list updates to show matching items
                 ========================================================= -->
            <div class="habit-filters">
              <button class="filter-btn active" data-filter="all">All</button>
              <button class="filter-btn" data-filter="daily">Daily</button>
              <button class="filter-btn" data-filter="weekdays">
                Weekdays
              </button>
              <button class="filter-btn" data-filter="weekends">
                Weekends
              </button>
              <button class="filter-btn" data-filter="custom">Custom</button>
            </div>

            <!-- =========================================================
                 HABIT LIST (UL)
                 Purpose: Container for habit items
                 
                 Content:
                 - Populated dynamically by habit-manager.js
                 - Each habit rendered as <li class="habit-item">
                 - Empty message shown when no habits
                 
                 Structure (per habit):
                 - Checkbox (completion toggle)
                 - Icon (from habit-icons-config.js)
                 - Name and description
                 - Edit button (opens modal)
                 - Delete button (with confirmation)
                 
                 ARIA:
                 - aria-live="polite" announces updates to screen readers
                 
                 Scrollbar: Custom styled (green theme)
                 ========================================================= -->
            <ul id="habit-list" class="habit-list" aria-live="polite"></ul>
          </div>
        </section>
      </main>
    </div>

    <!-- =========================================================
         HABIT MODAL (Create/Edit Habit)
         Purpose: Form for creating new habits or editing existing ones
         
         Modal States:
         - Hidden: .modal (default, aria-hidden="true")
         - Visible: .modal.active (shown via JS)
         
         Form Fields:
         1. Habit Name (required, text input)
         2. Description (optional, textarea)
         3. Frequency (Daily, Weekdays, Weekends, Custom)
         4. Custom Days (shown only when Custom selected)
         5. Icon Selection (grid of habit icons)
         
         Actions:
         - Save: Creates new habit or updates existing
         - Cancel: Closes modal without saving
         - Delete: Removes habit (only shown when editing)
         
         Validation:
         - Habit name is required
         - Custom frequency requires at least one day selected
         
         Data Flow:
         1. User fills form
         2. Click Save → habit-manager.js processes
         3. POST /api/habits (new) or PUT /api/habits/:id (edit)
         4. Modal closes, habit list refreshes
         
         Accessibility:
         - aria-hidden toggles based on visibility
         - Keyboard navigation supported (Tab, Enter, Esc)
         - Focus trapped within modal when open
         ========================================================= -->
    <div id="habit-modal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <!-- =========================================================
             MODAL HEADER
             Purpose: Title and close button
             Title: "Add New Habit" (create) or "Edit Habit" (edit)
             ========================================================= -->
        <div class="modal-header">
          <!-- Modal title (changes based on create/edit mode) -->
          <h3 id="modal-title">Add New Habit</h3>
          <!-- Close button (× symbol) -->
          <button class="close-modal" aria-label="Close">&times;</button>
        </div>

        <!-- =========================================================
             MODAL BODY (Form Content)
             Purpose: All input fields for habit creation/editing
             ========================================================= -->
        <div class="modal-body">
          <form id="habit-form">
            <!-- =========================================================
                 HABIT NAME FIELD
                 Purpose: Primary identifier for the habit
                 Validation: Required, cannot be empty
                 Example: "Morning Meditation", "Read 30 minutes"
                 ========================================================= -->
            <div class="form-group">
              <label for="habit-name">Habit Name</label>
              <input
                type="text"
                id="habit-name"
                required
                placeholder="e.g., Morning Meditation"
              />
            </div>

            <!-- =========================================================
                 DESCRIPTION FIELD
                 Purpose: Optional context/motivation for the habit
                 Validation: Optional
                 Example: "Helps me stay focused throughout the day"
                 ========================================================= -->
            <div class="form-group">
              <label for="habit-description">Description (Optional)</label>
              <textarea
                id="habit-description"
                placeholder="Why this habit matters to you..."
              ></textarea>
            </div>

            <!-- =========================================================
                 FREQUENCY SELECTION
                 Purpose: Choose when habit should be tracked
                 
                 Options:
                 - Daily: Every day (Mon-Sun)
                 - Weekdays: Monday through Friday
                 - Weekends: Saturday and Sunday
                 - Custom: User selects specific days
                 
                 Behavior:
                 - Active button gets .active class (green background)
                 - Custom shows day checkboxes below
                 - Stored as frequency type in MongoDB
                 ========================================================= -->
            <div class="form-group">
              <label>Frequency</label>
              <div class="frequency-options">
                <button
                  type="button"
                  class="freq-btn active"
                  data-value="daily"
                >
                  Daily
                </button>
                <button type="button" class="freq-btn" data-value="weekdays">
                  Weekdays
                </button>
                <button type="button" class="freq-btn" data-value="weekends">
                  Weekends
                </button>
                <button type="button" class="freq-btn" data-value="custom">
                  Custom
                </button>
              </div>
            </div>

            <!-- =========================================================
                 CUSTOM DAYS SELECTION
                 Purpose: Specify exact days for custom frequency
                 
                 Visibility: Hidden by default, shown when Custom selected
                 
                 Days:
                 - Mon, Tue, Wed, Thu, Fri, Sat, Sun
                 
                 Validation:
                 - At least one day must be selected for Custom
                 - Stored as array in MongoDB (e.g., ["mon", "wed", "fri"])
                 
                 Style:
                 - Custom checkbox design with green check animation
                 - Checkbox hidden, label styled as button
                 ========================================================= -->
            <div class="form-group custom-days hidden">
              <div class="day-checkboxes">
                <label><input type="checkbox" value="mon" /> Mon</label>
                <label><input type="checkbox" value="tue" /> Tue</label>
                <label><input type="checkbox" value="wed" /> Wed</label>
                <label><input type="checkbox" value="thu" /> Thu</label>
                <label><input type="checkbox" value="fri" /> Fri</label>
                <label><input type="checkbox" value="sat" /> Sat</label>
                <label><input type="checkbox" value="sun" /> Sun</label>
              </div>
            </div>

            <!-- =========================================================
                 ICON SELECTION
                 Purpose: Choose visual icon for habit identification
                 
                 Icons:
                 - Loaded from habit-icons-config.js
                 - Grid layout with clickable options
                 - Active icon gets green border
                 
                 Icon Types:
                 - Activities (meditation, exercise, reading)
                 - Health (water, sleep, vegetables)
                 - Productivity (coding, writing, learning)
                 - Wellness (stretching, journaling, gratitude)
                 
                 Storage:
                 - Stored as filename in MongoDB
                 - Path constructed: /frontend/assets/habit-icons/{filename}
                 
                 Behavior:
                 - Click icon to select (one active at a time)
                 - First icon selected by default
                 - Icons populated by habits.js loadHabitIcons()
                 ========================================================= -->
            <div class="form-group">
              <label>Choose Icon</label>
              <div class="icon-selector" id="icon-selector">
                <!-- Icons will be loaded dynamically from habit-icons-config.js -->
              </div>
            </div>
          </form>
        </div>

        <!-- =========================================================
             MODAL FOOTER (Action Buttons)
             Purpose: Save, cancel, or delete habit
             
             Buttons:
             1. Cancel: Close modal without saving (always visible)
             2. Save: Create new or update habit (always visible)
             3. Delete: Remove habit (only visible when editing)
             
             Button States:
             - Create Mode: Cancel + Save visible
             - Edit Mode: Cancel + Save + Delete visible
             
             Actions:
             - Cancel: Closes modal, discards changes
             - Save: Validates and submits to backend
             - Delete: Shows confirmation, removes from MongoDB
             ========================================================= -->
        <div class="modal-footer">
          <!-- Cancel button (closes modal) -->
          <button type="button" class="btn-outline cancel-btn">Cancel</button>
          <!-- Save button (creates/updates habit) -->
          <button type="button" class="btn save-btn">Save Habit</button>
          <!-- Delete button (only shown when editing) -->
          <button type="button" class="btn-danger delete-btn hidden">
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- =========================================================
         JAVASCRIPT MODULES
         Load order matters for dependencies
         ========================================================= -->

    <!-- Main application script (sidebar loader, authentication) -->
    <script src="/frontend/main.js"></script>

    <!-- Daily motivation quotes system -->
    <script src="../shared/daily-motivation.js"></script>

    <!-- Habits page controller (statistics, streak, habit list) -->
    <!-- Type="module" for ES6 import/export support -->
    <script type="module" src="habits.js"></script>
  </body>
</html>
